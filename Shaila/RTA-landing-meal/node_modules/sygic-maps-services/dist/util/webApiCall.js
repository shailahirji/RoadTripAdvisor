'use strict';

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

var _instanceId = require('../util/instanceId');

var _instanceId2 = _interopRequireDefault(_instanceId);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.webApiCall = function (options) {
  var apiKey = options.key || '';

  return function (path, query) {
    var callback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

    var queryOptions = query.options || {};
    delete query.options;

    if (queryOptions.uid && !query.id) {
      query.id = _instanceId2.default.id;
    }

    if (queryOptions && queryOptions.method === 'POST') {
      _axios2.default.post(path, query, {
        params: { key: apiKey }
      }).then(function (response) {
        callback(null, response);
      }).catch(function (error) {
        callback(error, null);
      });
    } else {
      query.key = apiKey;

      _axios2.default.get(path, {
        params: query
      }).then(function (response) {
        callback(null, response);
      }).catch(function (error) {
        callback(error, null);
      });
    }
  };
};