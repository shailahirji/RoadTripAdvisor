{"ast":null,"code":"import _classCallCheck from \"/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/src/components/MealPreferences.js\";\nimport React, { Component } from \"react\";\nimport Select from \"react-select\"; // import {Container, Col, Row,Button} from 'reactstrap'\n\nimport { Container } from \"reactstrap\";\nimport { Stitch, AnonymousCredential, RemoteMongoClient } from \"mongodb-stitch-browser-sdk\";\nimport \"./App.css\";\nimport MealMap from \"./MealMap.js\";\nimport MealCard from \"./MealCard.js\";\nimport Card from \"./Card.js\";\nimport Itinerary from \"./Itinerary\";\n\nvar MealPreferences =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(MealPreferences, _React$Component);\n\n  function MealPreferences(props) {\n    var _this;\n\n    _classCallCheck(this, MealPreferences);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MealPreferences).call(this, props));\n\n    _this.selectedKeywords = function (selection) {\n      _this.setState({\n        selected: selection\n      });\n    };\n\n    _this.selectPrice = function (price) {\n      _this.setState({\n        price_range: price\n      });\n    };\n\n    _this.selectedDistance = function (distance) {\n      _this.setState({\n        distance: distance\n      });\n    };\n\n    _this.selectedRatings = function (rate) {\n      _this.setState({\n        ratings: rate\n      });\n    };\n\n    _this.displayedResults = function (results) {\n      _this.setState({\n        search_results: results\n      });\n    };\n\n    _this.handleLoadChange = function (event) {\n      _this.setState({\n        selectedTrip: event.target.value\n      });\n    };\n\n    _this.state = {\n      selected: [],\n      count: 0,\n      price_range: \"any\",\n      //any price range\n      distance: \"any\",\n      ratings: \"any\",\n      search_result: [],\n      itinerary: [],\n      userID: \"\",\n      addToDB: false,\n      savedTrips: [],\n      selectedTrip: \"\",\n      location: _this.props.location.state\n    };\n    _this.card = null;\n    _this.onMouseClickAdd = _this.onMouseClickAdd.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.addTrip = _this.addTrip.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.loadTrip = _this.loadTrip.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.removeEvent = _this.removeEvent.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.loadSavedTrips = _this.loadSavedTrips.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleLoadChange = _this.handleLoadChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(MealPreferences, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      //intilize the app client\n      this.client = Stitch.initializeDefaultAppClient(\"rta-rgwjk\"); //get a mongodb service client\n      //this is used for logging in and communitction with stitch\n\n      var mongodb = this.client.getServiceClient(RemoteMongoClient.factory, \"mongodb-atlas\"); //get reference to the todos database\n\n      this.db = mongodb.db(\"RTA\");\n      this.displayOnLoad(); //Load saved trips into savedTrips array\n\n      this.loadSavedTrips();\n    }\n  }, {\n    key: \"displayOnLoad\",\n    value: function displayOnLoad() {\n      //Anonymously log in and display cmments on load\n      this.client.auth.loginWithCredential(new AnonymousCredential()).then(console.log(\"success!\")).catch(console.error);\n    }\n  }, {\n    key: \"addTrip\",\n    value: function addTrip() {\n      var locations = this.state.location; //insert the todo into the remote stitch db\n      //then re query the db and display the new todos\n      // this.db.collection(\"trip\").insertOne({\"ownder_id\":this.client.auth.user.id,\"tripname\":locations.from+\"-\"+locations.to,\n      //                                                   \"trip\":[{\"start\":locations.from},{\"end\":locations.to}],\"waypoints\":this.state.itinerary})\n      //                                                   .then(console.log(\"success\")).catch(console.error);\n\n      try {\n        this.db.collection(\"trip\").updateOne({\n          tripname: locations.from + \"-\" + locations.to\n        }, {\n          $set: {\n            waypoints: this.state.itinerary,\n            from: locations.from,\n            to: locations.to\n          }\n        }, {\n          upsert: true\n        });\n      } catch (e) {\n        console.log(e);\n      } // Load saved trips into savedTrips array\n\n\n      this.loadSavedTrips();\n    } // Load saved trips into savedTrips array and trip names into tripNames array\n\n  }, {\n    key: \"loadSavedTrips\",\n    value: function loadSavedTrips() {\n      var _this2 = this;\n\n      this.db.collection(\"trip\").find({}, {\n        tripname: 1,\n        _id: 0\n      }).toArray().then(function (savedTrips) {\n        _this2.setState({\n          savedTrips: savedTrips\n        });\n      });\n    }\n  }, {\n    key: \"onMouseClickAdd\",\n    value: function onMouseClickAdd(lat, lng, name) {\n      this.addToDB = true;\n      var newItinerary = this.state.itinerary;\n      newItinerary.push({\n        event: name,\n        pos: {\n          lat: lat,\n          lng: lng\n        }\n      });\n      this.setState({\n        itinerary: newItinerary\n      });\n\n      for (var i = 0; i < this.state.itinerary.length; i++) {\n        console.log(this.state.itinerary[i].pos.lat);\n        console.log(this.state.itinerary[i].pos.lng);\n        console.log(this.state.itinerary[i].event);\n      }\n    }\n  }, {\n    key: \"removeEvent\",\n    value: function removeEvent(name) {\n      var newItinerary = this.state.itinerary;\n      console.log(name);\n\n      for (var k = 0; k < newItinerary.length; k++) {\n        console.log(newItinerary[k].event);\n\n        if (newItinerary[k].event === name) {\n          console.log(\"grapes\");\n          newItinerary.splice(newItinerary.indexOf(name), 1);\n        }\n      }\n\n      this.setState({\n        itinerary: newItinerary\n      });\n\n      for (var i = 0; i < this.state.itinerary.length; i++) {\n        console.log(this.state.itinerary[i].pos.lat);\n        console.log(this.state.itinerary[i].pos.lng);\n        console.log(this.state.itinerary[i].event);\n      } //array.splice(array.indexOf(key),1);\n      // console.log(\"hi\")\n\n    } //get data back from child\n\n  }, {\n    key: \"loadTrip\",\n    value: function loadTrip() {\n      console.log(\"Load the Damn Trip!\");\n      console.log(this.state.selectedTrip);\n      var i;\n\n      for (i = 0; i < this.state.savedTrips.length; i++) {\n        console.log(this.state.savedTrips[i].tripname);\n\n        if (this.state.selectedTrip == this.state.savedTrips[i].tripname) {\n          var newLocation = this.state.location;\n          newLocation.from = this.state.savedTrips[i].from;\n          newLocation.to = this.state.savedTrips[i].to;\n          this.setState({\n            itinerary: this.state.savedTrips[i].waypoints,\n            location: newLocation\n          });\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var selectStyle = {\n        position: \"fixed\",\n        top: 600,\n        left: 400\n      };\n      var buttonStyle = {\n        position: \"fixed\",\n        top: 600,\n        left: 200\n      };\n      return React.createElement(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, React.createElement(MealCard, {\n        color: \"#ffc107\",\n        getKeywordList: this.selectedKeywords,\n        getPrice: this.selectPrice,\n        getRadius: this.selectedDistance,\n        getRatings: this.selectedRatings,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }), React.createElement(MealMap, {\n        search: this.state.selected,\n        price: this.state.price_range,\n        reviews: this.state.ratings,\n        radius: this.state.distance,\n        locations: this.state.location,\n        handleClick: this.onMouseClickAdd,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }), React.createElement(Itinerary, {\n        events: this.state.itinerary,\n        locations: this.state.location,\n        handleClick: this.removeEvent,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        type: \"button\",\n        style: buttonStyle,\n        class: \"btn btn-warning pl-5 pr-5\",\n        disabled: !this.addToDB,\n        onClick: this.addTrip,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }, \"Save Trip\"), React.createElement(\"form\", {\n        style: selectStyle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, React.createElement(\"select\", {\n        name: \"trip\",\n        onChange: this.handleLoadChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, this.state.savedTrips.map(function (trip) {\n        return React.createElement(\"option\", {\n          value: trip.tripname,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 240\n          },\n          __self: this\n        }, trip.tripname);\n      })), React.createElement(\"button\", {\n        type: \"button\",\n        class: \"btn btn-warning pl-5 pr-5\",\n        onClick: this.loadTrip,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, \"Load\")));\n    }\n  }]);\n\n  return MealPreferences;\n}(React.Component);\n\nexport default MealPreferences;","map":{"version":3,"sources":["/Volumes/HD/RoadTripAdvisor/Fred/RTA-landing-meal/src/components/MealPreferences.js"],"names":["React","Component","Select","Container","Stitch","AnonymousCredential","RemoteMongoClient","MealMap","MealCard","Card","Itinerary","MealPreferences","props","selectedKeywords","selection","setState","selected","selectPrice","price","price_range","selectedDistance","distance","selectedRatings","rate","ratings","displayedResults","results","search_results","handleLoadChange","event","selectedTrip","target","value","state","count","search_result","itinerary","userID","addToDB","savedTrips","location","card","onMouseClickAdd","bind","addTrip","loadTrip","removeEvent","loadSavedTrips","client","initializeDefaultAppClient","mongodb","getServiceClient","factory","db","displayOnLoad","auth","loginWithCredential","then","console","log","catch","error","locations","collection","updateOne","tripname","from","to","$set","waypoints","upsert","e","find","_id","toArray","lat","lng","name","newItinerary","push","pos","i","length","k","splice","indexOf","newLocation","selectStyle","position","top","left","buttonStyle","map","trip"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Select from \"react-select\";\n// import {Container, Col, Row,Button} from 'reactstrap'\nimport { Container } from \"reactstrap\";\nimport {\n  Stitch,\n  AnonymousCredential,\n  RemoteMongoClient\n} from \"mongodb-stitch-browser-sdk\";\nimport \"./App.css\";\nimport MealMap from \"./MealMap.js\";\nimport MealCard from \"./MealCard.js\";\nimport Card from \"./Card.js\";\nimport Itinerary from \"./Itinerary\";\n\nclass MealPreferences extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selected: [],\n      count: 0,\n      price_range: \"any\", //any price range\n      distance: \"any\",\n      ratings: \"any\",\n      search_result: [],\n      itinerary: [],\n      userID: \"\",\n      addToDB: false,\n      savedTrips: [],\n      selectedTrip: \"\",\n      location: this.props.location.state\n    };\n    this.card = null;\n    this.onMouseClickAdd = this.onMouseClickAdd.bind(this);\n    this.addTrip = this.addTrip.bind(this);\n    this.loadTrip = this.loadTrip.bind(this);\n    this.removeEvent = this.removeEvent.bind(this);\n    this.loadSavedTrips = this.loadSavedTrips.bind(this);\n    this.handleLoadChange = this.handleLoadChange.bind(this);\n  }\n\n  componentDidMount() {\n    //intilize the app client\n    this.client = Stitch.initializeDefaultAppClient(\"rta-rgwjk\");\n    //get a mongodb service client\n    //this is used for logging in and communitction with stitch\n    const mongodb = this.client.getServiceClient(\n      RemoteMongoClient.factory,\n      \"mongodb-atlas\"\n    );\n\n    //get reference to the todos database\n    this.db = mongodb.db(\"RTA\");\n    this.displayOnLoad();\n\n    //Load saved trips into savedTrips array\n    this.loadSavedTrips();\n  }\n\n  displayOnLoad() {\n    //Anonymously log in and display cmments on load\n    this.client.auth\n      .loginWithCredential(new AnonymousCredential())\n      .then(console.log(\"success!\"))\n      .catch(console.error);\n  }\n\n  addTrip() {\n    const locations = this.state.location;\n    //insert the todo into the remote stitch db\n    //then re query the db and display the new todos\n    // this.db.collection(\"trip\").insertOne({\"ownder_id\":this.client.auth.user.id,\"tripname\":locations.from+\"-\"+locations.to,\n    //                                                   \"trip\":[{\"start\":locations.from},{\"end\":locations.to}],\"waypoints\":this.state.itinerary})\n    //                                                   .then(console.log(\"success\")).catch(console.error);\n    try {\n      this.db.collection(\"trip\").updateOne(\n        { tripname: locations.from + \"-\" + locations.to },\n        {\n          $set: {\n            waypoints: this.state.itinerary,\n            from: locations.from,\n            to: locations.to\n          }\n        },\n        { upsert: true }\n      );\n    } catch (e) {\n      console.log(e);\n    }\n\n    // Load saved trips into savedTrips array\n    this.loadSavedTrips();\n  }\n\n  // Load saved trips into savedTrips array and trip names into tripNames array\n  loadSavedTrips() {\n    this.db\n      .collection(\"trip\")\n      .find({}, { tripname: 1, _id: 0 })\n      .toArray()\n      .then(savedTrips => {\n        this.setState({ savedTrips });\n      });\n  }\n\n  onMouseClickAdd(lat, lng, name) {\n    this.addToDB = true;\n    var newItinerary = this.state.itinerary;\n    newItinerary.push({ event: name, pos: { lat: lat, lng: lng } });\n    this.setState({\n      itinerary: newItinerary\n    });\n    for (var i = 0; i < this.state.itinerary.length; i++) {\n      console.log(this.state.itinerary[i].pos.lat);\n      console.log(this.state.itinerary[i].pos.lng);\n      console.log(this.state.itinerary[i].event);\n    }\n  }\n\n  removeEvent(name) {\n    var newItinerary = this.state.itinerary;\n    console.log(name);\n    for (var k = 0; k < newItinerary.length; k++) {\n      console.log(newItinerary[k].event);\n      if (newItinerary[k].event === name) {\n        console.log(\"grapes\");\n        newItinerary.splice(newItinerary.indexOf(name), 1);\n      }\n    }\n    this.setState({\n      itinerary: newItinerary\n    });\n    for (var i = 0; i < this.state.itinerary.length; i++) {\n      console.log(this.state.itinerary[i].pos.lat);\n      console.log(this.state.itinerary[i].pos.lng);\n      console.log(this.state.itinerary[i].event);\n    }\n    //array.splice(array.indexOf(key),1);\n    // console.log(\"hi\")\n  }\n\n  //get data back from child\n  selectedKeywords = selection => {\n    this.setState({\n      selected: selection\n    });\n  };\n\n  selectPrice = price => {\n    this.setState({\n      price_range: price\n    });\n  };\n\n  selectedDistance = distance => {\n    this.setState({\n      distance: distance\n    });\n  };\n\n  selectedRatings = rate => {\n    this.setState({\n      ratings: rate\n    });\n  };\n\n  displayedResults = results => {\n    this.setState({\n      search_results: results\n    });\n  };\n\n  handleLoadChange = event => {\n    this.setState({ selectedTrip: event.target.value });\n  };\n\n  loadTrip() {\n    console.log(\"Load the Damn Trip!\");\n\n    console.log(this.state.selectedTrip);\n\n    var i;\n    for (i = 0; i < this.state.savedTrips.length; i++) {\n      console.log(this.state.savedTrips[i].tripname);\n      if (this.state.selectedTrip == this.state.savedTrips[i].tripname) {\n        var newLocation = this.state.location;\n        newLocation.from = this.state.savedTrips[i].from;\n        newLocation.to = this.state.savedTrips[i].to;\n\n        this.setState({\n          itinerary: this.state.savedTrips[i].waypoints,\n          location: newLocation\n        });\n        break;\n      }\n    }\n  }\n\n  render() {\n    var selectStyle = { position: \"fixed\", top: 600, left: 400 };\n    var buttonStyle = { position: \"fixed\", top: 600, left: 200 };\n    return (\n      <Container>\n        {/* <div>\n          <Button style={buttonStyle} >Meal</Button>\n          <Button style={buttonStyle} onClick={this.displayCard('travelers') } >Travelers</Button>\n         </div> */}\n        <MealCard\n          color=\"#ffc107\"\n          getKeywordList={this.selectedKeywords}\n          getPrice={this.selectPrice}\n          getRadius={this.selectedDistance}\n          getRatings={this.selectedRatings}\n        />\n        <MealMap\n          search={this.state.selected}\n          price={this.state.price_range}\n          reviews={this.state.ratings}\n          radius={this.state.distance}\n          locations={this.state.location}\n          handleClick={this.onMouseClickAdd}\n        />\n        <Itinerary\n          events={this.state.itinerary}\n          locations={this.state.location}\n          handleClick={this.removeEvent}\n        />\n        <button\n          type=\"button\"\n          style={buttonStyle}\n          class=\"btn btn-warning pl-5 pr-5\"\n          disabled={!this.addToDB}\n          onClick={this.addTrip}\n        >\n          Save Trip\n        </button>\n        <form style={selectStyle}>\n          <select name=\"trip\" onChange={this.handleLoadChange}>\n            {this.state.savedTrips.map(trip => {\n              return <option value={trip.tripname}>{trip.tripname}</option>;\n            })}\n          </select>\n          <button\n            type=\"button\"\n            class=\"btn btn-warning pl-5 pr-5\"\n            onClick={this.loadTrip}\n          >\n            Load\n          </button>\n        </form>\n      </Container>\n    );\n  }\n}\n\nexport default MealPreferences;\n"]},"metadata":{},"sourceType":"module"}